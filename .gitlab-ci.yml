# Debug GitLab CI/CD Pipeline
stages:  
  - debug
  - test_simple

variables:
  UV_CACHE_DIR: "$CI_PROJECT_DIR/.cache/uv"

# Debug environment
debug_env:
  stage: debug
  image: python:3.10
  script:
    - echo "=== SYSTEM INFO ==="
    - python --version
    - pip --version
    - pwd
    - ls -la
    - echo "=== INSTALL UV ==="
    - pip install uv
    - uv --version
    - echo "=== CHECK FILES ==="
    - ls -la src/
    - cat pyproject.toml | head -20
    - echo "=== END DEBUG ==="
  only:
    - main

# Simple test
test_basic:
  stage: test_simple
  image: python:3.10
  script:
    - echo "Installing uv..."
    - pip install uv
    - echo "Creating venv..."
    - uv venv
    - echo "Activating venv..."
    - source .venv/bin/activate
    - echo "Installing package..."
    - uv pip install -e . || (echo "Install failed, trying with verbose output..." && uv pip install -e . -v)
    - echo "Running basic import test..."
    - python -c "import plant_disease; print('Import successful!')"
  only:
    - main